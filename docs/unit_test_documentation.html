<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
    <head>
        <title>Unit Test documentation</title>
        <style type="text/css">
            body {
                padding-left: 3%;
                padding-right: 3%;
            }
            pre {
                font-family: courier;
                font-size: 80%;
                border: 1px solid;
                background-color: #cccccc;
                padding: 5px;
                margin-left: 5%;
                margin-right: 8%;
            }
            .code, .new_code, pre.new_code {
                font-weight: bold;
            }
            div.copyright {
                font-size: 80%;
                color: gray;
            }
            div.copyright a {
                color: gray;
            }
            ul.api {
                padding-left: 0em;
                padding-right: 25%;
            }
            ul.api li {
                margin-top: 0.2em;
                margin-bottom: 0.2em;
                list-style: none;
                text-indent: -3em;
                padding-left: 3em;
            }
            div.demo {
                border: 4px ridge;
                border-color: gray;
                padding: 10px;
                margin: 5px;
                margin-left: 20px;
                margin-right: 40px;
                background-color: white;
            }
            div.demo span.fail {
                color: red;
            }
            div.demo span.pass {
                color: green;
            }
            div.demo h1 {
                font-size: 12pt;
                text-align: left;
                font-weight: bold;
            }
            table {
                border: 2px outset;
                border-color: gray;
                background-color: white;
                margin: 5px;
                margin-left: 5%;
                margin-right: 5%;
            }
            td {
                font-size: 80%;
            }
        </style>
        <link rel="Shortcut icon" href="images/lc.ico" />
        <meta name="author" content="Marcus Baker" />
            </head>
    <body>
        <h1>Unit Test documentation</h1>
        <div class="in">
            This page...
                        <ul>
                <li>
                    <a href="#unit">Test cases</a> and basic assertions.
                </li>
                <li>
                    <a href="#extending_unit">Extending test cases</a>.
                </li>
                <li>
                    <a href="#running_unit">Running a single case</a>.
                </li>
                <li>
                    Different ways to <a href="#group">group tests</a>.
                </li>
                <li>
                    Intergrating <a href="#legacy">legacy test cases</a>.
                </li>
            </ul>        </div>
        <div class="out">
            Related resources...
                        <ul>
                <li>
                    SimpleTest project page on <a href="http://sourceforge.net/projects/simpletest/">SourceForge</a>.
                </li>
                <li>
                    SimpleTest download page on <a href="http://www.lastcraft.com/simple_test.php">LastCraft</a>.
                </li>
           </ul>        </div>
        <div class="content">
                        <p>
                This documentation is shipped with the
                <a href="simple_test.php">SimpleTest</a> package.
            </p>
            <p>
                <a class="target" name="unit"><h2>Unit test cases</h2></a>
            </p>
            <p>
                A sample test case looks like this...
<pre><strong>
class FileTestCase extends UnitTestCase {
    function FileTestCase() {
        $this-&gt;UnitTestCase(&apos;File test&apos;);
    }
}</strong>
</pre>
                If no test name is supplied whe chaing the constructor then
                the class name will be taken instead.
                Tests are added as methods in the test case whose names
                start with the string &quot;test&quot; and
                when the test case is invoked all such methods are run in
                the random order that PHP introspection finds them.
                As many test methods can be added as needed.
                Before each test method, the <span class="code">setUp()</span>
                method is invoked and after each test method the
                <span class="code">tearDown()</span> method is invoked.
                Override these to add common test start up and test clean
                up code when needed.
                For example...
<pre>
require_once(&apos;../classes/writer.php&apos;);

class FileTestCase extends UnitTestCase {
    function FileTestCase() {
        $this-&gt;UnitTestCase(&apos;File test&apos;);
    }<strong>
    function setUp() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function tearDown() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function testCreation() {
        $writer = &new FileWriter(&apos;../temp/test.txt&apos;);
        $writer-&gt;write(&apos;Hello&apos;);
        $this-&gt;assertTrue(file_exists(&apos;../temp/test.txt&apos;), &apos;File created&apos;);
    }</strong>
}
</pre>
                The means of reporting test results are by attached observers
                that are notified by various <span class="code">assert...()</span>
                methods.
                Here is the full list for the <span class="code">UnitTestCase</span>
                class, the default for SimpleTest...
                <table>
                    <tr><td><span class="code">assertTrue($x)</span></td><td>Fail if $x is false</td></tr>
                    <tr><td><span class="code">assertFalse($x)</span></td><td>Fail if $x is true</td></tr>
                    <tr><td><span class="code">assertNull($x)</span></td><td>Fail if $x is set</td></tr>
                    <tr><td><span class="code">assertNotNull($x)</span></td><td>Fail if $x not set</td></tr>
                    <tr><td><span class="code">assertIsA($x, $t)</span></td><td>Fail if $x is not the class or type $t</td></tr>
                    <tr><td><span class="code">assertEqual($x,&nbsp;$y)</span></td><td>Fail if $x == $y is false</td></tr>
                    <tr><td><span class="code">assertNotEqual($x,&nbsp;$y)</span></td><td>Fail if $x == $y is true</td></tr>
                    <tr><td><span class="code">assertIdentical($x,&nbsp;$y)</span></td><td>Fail if $x === $y is false</td></tr>
                    <tr><td><span class="code">assertNotIdentical($x,&nbsp;$y)</span></td><td>Fail if $x === $y is true</td></tr>
                    <tr><td><span class="code">assertReference($x,&nbsp;$y)</span></td><td>Fail unless $x and $y are the same variable</td></tr>
                    <tr><td><span class="code">assertCopy($x,&nbsp;$y)</span></td><td>Fail if $x and $y are the same variable</td></tr>
                    <tr><td><span class="code">assertWantedPattern($p,&nbsp;$x)</span></td><td>Fail unless the regex $p matches $x</td></tr>
                    <tr><td><span class="code">assertNoUnwantedPattern($p,&nbsp;$x)</span></td><td>Fail if the regex $p matches $x</td></tr>
                </table>
                All assertion methods can take an optional description to
                label the displayed result with.
                If omitted a default message is sent instead which is usually
                sufficient.
            </p>
            <p>
                <a class="target" name="extending_unit"><h2>Extending test cases</h2></a>
            </p>
            <p>
                Of course additional test methods can be added to create
                specific types of test case to so as to extend framework...
<pre>
if (!defined(&apos;SIMPLE_TEST&apos;)) {
    define(&apos;SIMPLE_TEST&apos;, &apos;path/to/simpletest/&apos;);
}
require_once(SIMPLE_TEST . &apos;simple_unit&apos;);
<strong>
class FileTester extends UnitTestCase {
    function FileTester($name = false) {
        $this-&gt;UnitTestCase($name);
    }
    function assertFileExists($filename, $message = &apos;%s&apos;) {
        $this-&gt;assertTrue(
                file_exists($filename),
                sprintf($message, &apos;File [$filename] existence check&apos;));
    }</strong>
}
</pre>
                This new case can be now be inherited just like
                a normal test case...
            </p>
<pre>
class FileTestCase extends <strong>FileTester</strong> {
    function FileTestCase() {<strong>
        $this-&gt;FileTester(&apos;File test&apos;);</strong>
    }
    function setUp() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function tearDown() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function testCreation() {
        $writer = &new FileWriter(&apos;../temp/test.txt&apos;);
        $writer-&gt;write(&apos;Hello&apos;);<strong>
        $this-&gt;assertFileExists(&apos;../temp/test.txt&apos;);</strong>
    }
}
</pre>
            <p>
                The <span class="code">SIMPLE_TEST</span> constant is
                the path to the SimpleTest libraries and should be set
                before the first component is called.
                It is usually set in the top level tests.
            </p>
            <p>
                If you want a test case that does not have all of the
                <span class="code">UnitTestCase</span> assertions,
                only your own and <span class="code">assertTrue()</span>,
                you need to extend the <span class="code">TestCase</span>
                class instead.
                It is found in <em>simple_test.php</em> rather than
                <em>simple_unit.php</em>.
                See below if you want to incorporate other unit tester&apos;s
                test cases in your test suites.
            </p>
            <p>
                <a class="target" name="running_unit"><h2>Running a single test case</h2></a>
            </p>
            <p>
                You won&apos;t often run single test cases except when bashing
                away at a module that is having difficulty and you don&apos;t
                want to upset the main test suite.
                Here is the scaffolding needed to run the a lone test case...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;path/to/simpletest/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);<strong>
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);</strong>
    require_once("../classes/writer.php");

    class FileTestCase extends UnitTestCase {
        function FileTestCase() {
            $this-&gt;UnitTestCase(&apos;File test&apos;);
        }
        ...
    }<strong>
    $test = &new FileTestCase();
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();</strong>
?&gt;
</pre>
                As many observers can be attached as needed and they should
                subclass the <span class="code">TestReporter</span> interface
                in the <em>observer.php</em> file in SimpleTest.
                The minimal <span class="code">TestHtmlDisplay</span> already
                does this.
            </p>
            <p>
                <a class="target" name="group"><h2>Group tests</h2></a>
            </p>
            <p>
                To run a case as part of a group the test cases should
                be placed in files without the runner code...
<pre>
&lt;?php
    require_once("../classes/writer.php");

    class FileTester extends UnitTestCase {
        ...
    }<strong>
    GroupTest::ignore(&apos;FileTester&apos;);</strong>

    class FileTestCase extends FileTester {
        ...
    }
?&gt;
</pre>
                As many cases as needed can appear in a single file.
                The <span class="new_code">FileTester</span> class does
                no contain any actual tests, but is a base class for other
                test cases.
                For this reason we use the
                <span class="new_code">GroupTest::ignore()</span> directive
                to tell the upcoming group test to ignore it.
                This directive can appear anywhere in the file and works
                when a whole file of test cases is loaded (see below)/
                We will call this sample <em>file_test.php</em>.
            </p>
            <p>
                Next we create a group test file, called say <em>group_test.php</em>.
                You will think of a better name I am sure.
                We will add the test file using a safe method...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);<strong>
    require_once(&apos;file_test.php&apos;);

    $test = &new GroupTest(&apos;All file tests&apos;);
    $test-&gt;addTestCase(new FileTestCase());
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();</strong>
?&gt;
</pre>
                With this method, for every test case that we add we will have
                to <span class="new_code">require_once()</span> the test code
                file and manually instantiate each and every test case.
                We can save a lot of typing with...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);

    $test = &new GroupTest(&apos;All file tests&apos;);<strong>
    $test-&gt;addTestFile(&apos;file_test.php&apos;);</strong>
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();
?&gt;
</pre>
                What happens here is that the <span="code">GroupTest</span>
                class has done the <span class="code">require_once()</span>
                for us.
                It then checks to see if any new test case classes
                have been created by the new file and automatically adds
                them to the group test.
                Now all we have to do is add each new file.
            </p>
            <p>
                There are two things that could go wrong and which require care...
                <ol>
                    <li>
                        The file could already have been parsed by PHP and so no
                        new classes will have been added. You should make
                        sure that the test cases are only included in this file
                        and no others.
                    </li>
                    <li>
                        New test case extension classes thet get included will be
                        placed in the group test and run also.
                        You will need to add a <span class="new_code">GroupTest::ignore()</span>
                        directive for these classes or make sure that they are included
                        before the <span class="new_code">GroupTest::addTestFile()</span>
                        line.
                    </li>
                </ol>
                Group tests can be included in other group tests, but must be added
                manually.
                Adding them on a file basis will not work.
            </p>
            <p>
                In the above examples the line...
<pre><strong>
$test-&gt;run();
</strong></pre>
                ...is included.
                This effectively combines test running with grouping.
                For small projects this is what you want, but for larger ones
                you may want to group the tests in all sorts of ways.
            </p>
            <p>
                To get a more flexible group test we can subclass
                <span>GroupTest</span> and then instantiate it as needed...
<pre>
if (!defined(&apos;SIMPLE_TEST&apos;)) {
    define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
}
require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);
require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);
<strong>
class FileGroupTest extends GroupTest {
    function FileGroupTest() {
        $this-&gt;GroupTest(&apos;All file tests&apos;);
        $test-&gt;addTestFile(&apos;file_test.php&apos;);
    }
}</strong>
</pre>
                We can now invoke the tests from a separate runner file...
<pre>
if (!defined(&apos;SIMPLE_TEST&apos;)) {
    define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
}
require_once(&apos;file_group_test.php&apos;);
<strong>
$test = &new FileGroupTest();
$test->attachObserver(new TestHtmlDisplay());
$test->run();</strong>
</pre>
                ...or we can group them into larger group tests...
<pre>
if (!defined(&apos;SIMPLE_TEST&apos;)) {
    define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
}
require_once(&apos;file_group_test.php&apos;);
<strong>
$test = &new BigGroupTest("Big group");
$test->addTestCase(new FileGroupTest());
$test->addTestCase(...);
$test->attachObserver(new TestHtmlDisplay());
$test->run();</strong>
</pre>
                If we still wish to run the original group test and we
                don&apos;t want all of these little runner files, we can
                put the test runner code around guard bars when we create
                the group.
<pre>
class FileGroupTest extends GroupTest {
    function FileGroupTest() {
        $this-&gt;GroupTest(&apos;All file tests&apos;);
        $test-&gt;addTestFile(&apos;file_test.php&apos;);
    }
}
<strong>
if (!defined(&apos;RUNNER&apos;)) {
    define(&apos;RUNNER&apos;, true);</strong>
    $test = &new FileGroupTest();
    $test->attachObserver(new TestHtmlDisplay());
    $test->run();<strong>
}</strong>
</pre>
                This approach requires the guard to be set when including
                the group test file, but this is still less hassle than
                lots of separate runner files.
                You include the same guard on the top level tests to make sure
                that <span class="new_code">run()</span> once only
                from the top level script that has been invoked.
            </p>
            <p>
                <a class="target" name="legacy"><h2>Integrating legacy test cases</h2></a>
            </p>
            <p>
                If you already have unit tests for your code or are extending external
                classes that have tests, it is unlikely that all of the test cases
                are in SimpleTest format.
                Fortunately it is possible to incorporate test cases from other
                unit testers directly into SimpleTest group tests.
            </p>
            <p>
                Say we have the following
                <a href="http://sourceforge.net/projects/phpunit">PhpUnit</a>
                test case in the file <em>config_test.php</em>...
<pre><strong>
class ConfigFileTest extends TestCase {
    function ConfigFileTest() {
        $this->TestCase(&apos;Config file test&apos;);
    }
    function testContents() {
        $config = new ConfigFile(&apos;test.conf&apos;);
        $this->assertRegexp(&apos;/me/&apos;, $config->getValue(&apos;username&apos;));
    }
}
</strong></pre>
                The group test can recognise this as long as we include
                the appropriate adapter class before we add the test
                file...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);<strong>
    require_once(SIMPLE_TEST . &apos;adapters/phpunit_test_case.php&apos;);</strong>

    $test = &new GroupTest(&apos;All file tests&apos;);<strong>
    $test-&gt;addTestFile(&apos;config_test.php&apos;);</strong>
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();
?&gt;
</pre>
                There are only two adapters, the other is for the
                <a href="http://pear.php.net/manual/en/package.php.phpunit.php">PEAR</a>
                unit tester...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;simple_test/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);<strong>
    require_once(SIMPLE_TEST . &apos;adapters/pear_test_case.php&apos;);</strong>

    $test = &new GroupTest(&apos;All file tests&apos;);<strong>
    $test-&gt;addTestFile(&apos;some_pear_test_cases.php&apos;);</strong>
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();
?&gt;
</pre>
            </p>        </div>
        <div class="copyright">
            Copyright <a href="mailto:marcus@lastcraft.com">Marcus&nbsp;Baker</a>&nbsp;2003
        </div>
    </body>
</html>