<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
    <head>
        <title>Unit Test documentation</title>
        <style type="text/css">
            body {
                padding-left: 3%;
                padding-right: 3%;
            }
            pre {
                font-family: courier;
                font-size: 80%;
                border: 1px solid;
                background-color: #cccccc;
                padding: 5px;
                margin-left: 5%;
                margin-right: 8%;
            }
            .code, .new_code, pre.new_code {
                font-weight: bold;
            }
            div.copyright {
                font-size: 80%;
                color: gray;
            }
            div.copyright a {
                color: gray;
            }
            ul.api {
                padding-left: 0em;
                padding-right: 25%;
            }
            ul.api li {
                margin-top: 0.2em;
                margin-bottom: 0.2em;
                list-style: none;
                text-indent: -3em;
                padding-left: 3em;
            }
            div.demo {
                border: 4px ridge;
                border-color: gray;
                padding: 10px;
                margin: 5px;
                margin-left: 20px;
                margin-right: 40px;
                background-color: white;
            }
            div.demo span.fail {
                color: red;
            }
            div.demo span.pass {
                color: green;
            }
            div.demo h1 {
                font-size: 12pt;
                text-align: left;
                font-weight: bold;
            }
            table {
                border: 2px outset;
                border-color: gray;
                background-color: white;
                margin: 5px;
                margin-left: 5%;
                margin-right: 5%;
            }
            td {
                font-size: 80%;
            }
        </style>
        <link rel="Shortcut icon" href="images/lc.ico" />
        <meta name="author" content="Marcus Baker" />
            </head>
    <body>
        <h1>Unit Test documentation</h1>
        <div>
            The different sections of the documentation are...
            <ul>
                <li><a href="unit_test_documentation.html">Test cases</a></li>
                <li><a href="group_test_documentation.html">Group tests</a></li>
                <li><a href="reporter_documentation.html">Displaying results</a></li>
                <li><a href="server_stubs_documentation.html">Server stubs</a></li>
                <li><a href="mock_objects_documentation.html">Mock objects</a></li>
            </ul>
        </div>
        <div class="in">
            This page...
                        <ul>
                <li>
                    <a href="#unit">Unit test cases</a> and basic assertions.
                </li>
                <li>
                    <a href="#extending_unit">Extending test cases</a> to
                    customise them for your own project.
                </li>
                <li>
                    <a href="#running_unit">Running a single case</a> as
                    a single script.
                </li>
            </ul>        </div>
        <div>
            This documentation is shipped with the
            <a href="http://www.lastcraft.com/simple_test.php">SimpleTest</a> package.
        </div>
        <div class="content">
                        <p>
                <a class="target" name="unit"><h2>Unit test cases</h2></a>
            </p>
            <p>
                A sample test case looks like this...
<pre><strong>
class FileTestCase extends UnitTestCase {
    function FileTestCase() {
        $this-&gt;UnitTestCase(&apos;File test&apos;);
    }
}</strong>
</pre>
                If no test name is supplied whe chaining the constructor then
                the class name will be taken instead.
                This will be the name displayed in the test results.
            </p>
            <p>
                Actual tests are added as methods in the test case whose names
                start with the string &quot;test&quot; and
                when the test case is invoked all such methods are run in
                the random order that PHP introspection finds them.
                As many test methods can be added as needed.
                For example...
<pre>
require_once(&apos;../classes/writer.php&apos;);

class FileTestCase extends UnitTestCase {
    function FileTestCase() {
        $this-&gt;UnitTestCase(&apos;File test&apos;);
    }<strong>
    function setUp() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function tearDown() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function testCreation() {
        $writer = &new FileWriter(&apos;../temp/test.txt&apos;);
        $writer-&gt;write(&apos;Hello&apos;);
        $this-&gt;assertTrue(file_exists(&apos;../temp/test.txt&apos;), &apos;File created&apos;);
    }</strong>
}
</pre>
                Our only test method at the moment is <span class="new_code">testCreation()</span>
                where we check that a file has been created by our
                <span class="new_code">Writer</span> object.
                We could have put the <span class="new_code">unlink()</span>
                code into this method as well, but by placing it in
                <span class="new_code">setUp()</span> and
                <span class="new_code">tearDown()</span> we can use it with
                other test methods that we add.
            </p>
            <p>
                The <span class="new_code">setUp()</span> method is run
                just befor every test method.
                <span class="new_code">tearDown()</span> is run just after
                every test method.
                You can place some test case set up into the constructor, but
                you risk test inteference that way.
                This way is slightly slower, but it is safer.
            </p>
            <p>
                The means of reporting test results (see below) are by attached observers
                that are notified by various <span class="code">assert...()</span>
                methods.
                Here is the full list for the <span class="code">UnitTestCase</span>
                class, the default for SimpleTest...
                <table>
                    <tr><td><span class="code">assertTrue($x)</span></td><td>Fail if $x is false</td></tr>
                    <tr><td><span class="code">assertFalse($x)</span></td><td>Fail if $x is true</td></tr>
                    <tr><td><span class="code">assertNull($x)</span></td><td>Fail if $x is set</td></tr>
                    <tr><td><span class="code">assertNotNull($x)</span></td><td>Fail if $x not set</td></tr>
                    <tr><td><span class="code">assertIsA($x, $t)</span></td><td>Fail if $x is not the class or type $t</td></tr>
                    <tr><td><span class="code">assertEqual($x,&nbsp;$y)</span></td><td>Fail if $x == $y is false</td></tr>
                    <tr><td><span class="code">assertNotEqual($x,&nbsp;$y)</span></td><td>Fail if $x == $y is true</td></tr>
                    <tr><td><span class="code">assertIdentical($x,&nbsp;$y)</span></td><td>Fail if $x === $y is false</td></tr>
                    <tr><td><span class="code">assertNotIdentical($x,&nbsp;$y)</span></td><td>Fail if $x === $y is true</td></tr>
                    <tr><td><span class="code">assertReference($x,&nbsp;$y)</span></td><td>Fail unless $x and $y are the same variable</td></tr>
                    <tr><td><span class="code">assertCopy($x,&nbsp;$y)</span></td><td>Fail if $x and $y are the same variable</td></tr>
                    <tr><td><span class="code">assertWantedPattern($p,&nbsp;$x)</span></td><td>Fail unless the regex $p matches $x</td></tr>
                    <tr><td><span class="code">assertNoUnwantedPattern($p,&nbsp;$x)</span></td><td>Fail if the regex $p matches $x</td></tr>
                </table>
                All assertion methods can take an optional description to
                label the displayed result with.
                If omitted a default message is sent instead which is usually
                sufficient.
            </p>
            <p>
                Some examples...
<pre><strong>
$variable = null;
$this->assertNull($variable, &apos;Should be cleared&apos;);</strong>
</pre>
                ...will pass and normally show no message.
                If you have
                <a href="http://www.lastcraft.com/display_subclass_tutorial.php">set up the tester to display passes</a>
                as well then the message will be displayed as is.
<pre><strong>
$this->assertIdentical(0, false, &apos;Zero is not false [%s]&apos;);</strong>
</pre>
                This will fail as it performs a PHP <span class="new_code">===</span>
                check between the two values.
                The &quot;%s&quot; part will be replaced by the default
                error message that would have been shown if we had not
                supplied our own.
                This allows us to nest test messages.
<pre><strong>
$a = 1;
$b = $a;
$this->assertReference($a, $b);</strong>
</pre>
                Will fail as the variable &quot;$a&quot; is a copy of &quot;$b&quot;.
<pre><strong>
$this->assertWantedPattern(&apos;/hello/i&apos;, &apos;Hello world&apos;);</strong>
</pre>
                This will pass as using a case insensitive match the string
                &quot;hello&quot; is contained in &quot;Hello world&quot.
            </p>
            <p>
                <a class="target" name="extending_unit"><h2>Extending test cases</h2></a>
            </p>
            <p>
                Of course additional test methods can be added to create
                specific types of test case too so as to extend framework...
<pre>
if (!defined(&apos;SIMPLE_TEST&apos;)) {
    define(&apos;SIMPLE_TEST&apos;, &apos;path/to/simpletest/&apos;);
}
require_once(SIMPLE_TEST . &apos;simple_unit&apos;);
<strong>
class FileTester extends UnitTestCase {
    function FileTester($name = false) {
        $this-&gt;UnitTestCase($name);
    }
    function assertFileExists($filename, $message = &apos;%s&apos;) {
        $this-&gt;assertTrue(
                file_exists($filename),
                sprintf($message, &apos;File [$filename] existence check&apos;));
    }</strong>
}
</pre>
                This new case can be now be inherited just like
                a normal test case...
            </p>
<pre>
class FileTestCase extends <strong>FileTester</strong> {
    function FileTestCase() {<strong>
        $this-&gt;FileTester(&apos;File test&apos;);</strong>
    }
    function setUp() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function tearDown() {
        @unlink(&apos;../temp/test.txt&apos;);
    }
    function testCreation() {
        $writer = &new FileWriter(&apos;../temp/test.txt&apos;);
        $writer-&gt;write(&apos;Hello&apos;);<strong>
        $this-&gt;assertFileExists(&apos;../temp/test.txt&apos;);</strong>
    }
}
</pre>
            <p>
                The <span class="code">SIMPLE_TEST</span> constant is
                the path to the SimpleTest libraries and should be set
                before the first component is called.
                It is usually set in the top level tests.
            </p>
            <p>
                If you want a test case that does not have all of the
                <span class="code">UnitTestCase</span> assertions,
                only your own and <span class="code">assertTrue()</span>,
                you need to extend the <span class="code">TestCase</span>
                class instead.
                It is found in <em>simple_test.php</em> rather than
                <em>simple_unit.php</em>.
                See <a href="group_test_documentation.html">later</a> if you
                want to incorporate other unit tester&apos;s
                test cases in your test suites.
            </p>
            <p>
                <a class="target" name="running_unit"><h2>Running a single test case</h2></a>
            </p>
            <p>
                You won&apos;t often run single test cases except when bashing
                away at a module that is having difficulty and you don&apos;t
                want to upset the main test suite.
                Here is the scaffolding needed to run the a lone test case...
<pre>
&lt;?php
    if (!defined(&apos;SIMPLE_TEST&apos;)) {
        define(&apos;SIMPLE_TEST&apos;, &apos;path/to/simpletest/&apos;);
    }
    require_once(SIMPLE_TEST . &apos;simple_unit.php&apos;);<strong>
    require_once(SIMPLE_TEST . &apos;simple_html_test.php&apos;);</strong>
    require_once("../classes/writer.php");

    class FileTestCase extends UnitTestCase {
        function FileTestCase() {
            $this-&gt;UnitTestCase(&apos;File test&apos;);
        }
    }<strong>
    $test = &new FileTestCase();
    $test-&gt;attachObserver(new TestHtmlDisplay());
    $test-&gt;run();</strong>
?&gt;
</pre>
                This script will run as is, but will output zero passes
                and zero failures.
                As many observers can be attached as needed and they should
                subclass the <span class="code">TestReporter</span> interface
                in the <em>observer.php</em> file in SimpleTest.
                The minimal <span class="code">TestHtmlDisplay</span> already
                does this.
            </p>        </div>
        <div class="out">
            Related resources...
                        <ul>
                <li>
                    SimpleTest project page on <a href="http://sourceforge.net/projects/simpletest/">SourceForge</a>.
                </li>
                <li>
                    SimpleTest download page on <a href="http://www.lastcraft.com/simple_test.php">LastCraft</a>.
                </li>
           </ul>        </div>
        <div class="copyright">
            Copyright <a href="mailto:marcus@lastcraft.com">Marcus&nbsp;Baker</a>&nbsp;2003
        </div>
    </body>
</html>